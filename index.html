<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  </head>
  <body>
    <div class = "container">
       <div class="input-field col s6">
          <select id="name">
             <option value="" disabled selected>Name</option>
             <?!= list;  ?>
          </select>
       </div>
       <div>
          <button id="search" class="waves-effect waves-light btn-small" type="submit" name="action">Search
             <i class="material-icons right">search</i>
          </button>
          <a id="paid" class="waves-effect waves-light btn-small"><i class="material-icons right">check</i>Payment</a>
          
       </div>
    </div>
    <div id="tbl" class="container">
      <table class="highlight">
        <thead>
          <tr></tr>
        </thead>
        <tbody id = "table-body"></tbody>
      </table>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
 
    document.addEventListener('DOMContentLoaded', function() {
       var elems = document.querySelectorAll('select');
       var instances = M.FormSelect.init(elems);
    });
  
    var data = [];
    
    document.getElementById("search").addEventListener("click", doStuff);
    
    function doStuff(){
    var sname = document.getElementById("name").value;
       google.script.run.userSearched(sname);
       document.getElementById("name").value;
      
       google.script.run.withSuccessHandler(generateTable).getBal();
    
    }  
    
    function generateTable(dataArray){
    
       var tbody = document.getElementById("table-body");
       tbody.innerHTML = "";
       dataArray.forEach(function(r){
          var row = document.createElement("tr");
          var col1 = document.createElement("td");
          col1.textContent = r[0];
          var col2 = document.createElement("td");
          col2.textContent = r[1];
          var col3 = document.createElement("td");
          col3.textContent = r[2];
          var col4 = document.createElement("td");
          col4.textContent = r[3];
          var col5 = document.createElement("td");
          col5.textContent = r[4];
          row.appendChild(col1);
          row.appendChild(col2);
          row.appendChild(col3);
          row.appendChild(col4);
          row.appendChild(col5);
          tbody.appendChild(row);
      });
    }  
    
    document.getElementById("paid").addEventListener("click", doPayment);
     
    function doPayment(){
       var paid = confirm("Are you sure?");
       if (paid == true){
       google.script.run.doSearch();
       google.script.run.doSearch2();
       
       var tbody = document.getElementById("table-body");
       tbody.innerHTML = "";
       } else {
       return doStuff(); 
       }
    }
    </script>
  </body>
</html>


